##########################
 ## Tmux Config - TjlH ##
##########################

## External	{{{1

# don't want it to behave as a login shell each time
# FIXME: vim-screen spawns a new shell before the intended command.
set-option -qg	default-command	    "/bin/bash"
# Want to keep the COLORTERM env var so colours can be set properly in bash/vim
set-option -qag	update-environment  " COLORTERM"
# Try and fix restarting X
set-option -qag	update-environment  " XDG_SESSION_COOKIE"
set-option -qag	update-environment  " SESSION_MANAGER"
# Allow use of terminal alternate screen feature (terminfo)
set-window-option -qg	alternate-screen    on	# def: on

## General	{{{1

bind-key    r	source-file	~/.tmux.conf	# Allow Reload
set-option -qg	history-limit	10000		# Big History
set-option -qs	escape-time	300		# Require faster key repetition

bind-key -r q	display-panes			# Allow repition (hold down)

# Use utf8 (autoset if found from LC_ALL, LC_CTYPE, or LANG)
#set-option -qg	status-utf8	on	# def: off
#set-window-option -qg	utf8	on	# def: off

#bind-key    t	set-environment TERM "screen-color"	# FIXME: doesn't do anything
#bind-key    T	set-environment TERM "screen-256color"	# FIXME: doesn't do anything

### Prefix Key	{{{2
#set-option -qg	prefix S-Escape
set-option -qg	prefix	`		# def: C-b	# screen def: C-a
bind-key -r `	send-prefix		# def: C-b
set-option -qg	prefix2 C-b		# def: none
bind-key -r C-b	send-prefix -2		# def: C-b	# screen def: a
unbind-key  C-b				# def: send-prefix

### Session Locking  {{{2
#set-option -qg	lock-after-time	900	# def: 0	# enable locking
set-option -qg	lock-server	off	# def: on	# independent locking
# (I don't normally have lock(1) so try and use vlock first...)
set-option -qg	lock-command	"vlock || lock -np || away || busybox vlock"

bind-key -n C-M-l   run-shell "sudo xmtlock >/dev/null"
bind-key -n C-M-L   run-shell "sudo xmtlock all >/dev/null"


## Creation	{{{1

### sessions	{{{2
bind-key    C	new-session		# def: none
#bind-key    N	new-session		# def: none

### windows	{{{2
bind-key    c	new-window -c "#{?pane_current_path,#{pane_current_path},$HOME}"	# def: c
#bind-key    n	new-window -c "#{?pane_current_path,#{pane_current_path},$HOME}"	# def: c

### panes	{{{2
bind-key    s	split-window -c "#{?pane_current_path,#{pane_current_path},$HOME}"	# def: "	# horizontal split
bind-key    S	split-window -c "#{?pane_current_path,#{pane_current_path},$HOME}" -h	# def: %	# vertical split


## Navigation	{{{1

# vi like (auto set if 'vi' in $EDITOR)
#set-option -qg	status-keys	    vi
#set-window-option -qg	mode-keys   vi

### sessions	{{{2
bind-key -r _	switch-client -p	# def: (
bind-key -r +	switch-client -n	# def: )
bind-key    BTab	switch-client -l	# def: L
bind-key    S-Bspace	switch-client -l	# def: L
bind-key    W	choose-session		# def: s	# moniker: [W]hich session?

### windows	{{{2
set-option -qg	base-index	1	# def: 0	# 0 on far side
set-window-option -qg	pane-base-index	1	# def: 0
bind-key -r -	select-window -p	# def: p
bind-key -r =	select-window -n	# def: n
bind-key    Tab	select-window -l	# def: none	# screen def: C-a ??
bind-key    Bspace	select-window -l	# def: none
bind-key    w	choose-window		# def: w	# moniker: [w]hich [w]indow?

### panes	{{{2
bind-key    h	select-pane -L		# def: Left
bind-key    j	select-pane -D		# def: Down
bind-key    k	select-pane -U		# def: Up
bind-key    l	select-pane -R		# def: Right
#bind-key -r p	select-pane -t :.+	# def: o	# next pane numerically
#bind-key -r P	select-pane -t :.-	# def: none	# previous numerically
#bind-key    ;	select-pane -l		# def: ;	# FIXME: can't bind ;

## Manipulation {{{1

### sessions	{{{2
bind-key    N	command-prompt -I '#{session_name}'	"rename-session '%%'"	# def: $

### windows	{{{2
set-option -qg	renumber-windows    on	# def: off
#bind-key -r <	move-window -t -:	# def: none	# FIXME: no +- for sessions
#bind-key -r >	move-window -t +:	# def: none	# FIXME: no +- for sessions
bind-key    M	choose-session "move-window -t '%%:'"	# def: none
bind-key    n	command-prompt -I '#{window_name}'	"rename-window '%%'"	# def: ,
bind-key    i	command-prompt -I '#{window_index}'	"move-window -t '%%'"	# def: .
bind-key -r (	swap-window -t :-	# def: none
bind-key -r )	swap-window -t :+	# def: none

### panes	{{{2
bind-key -r b	break-pane		# def: !
bind-key -r B	break-pane -d		# background break
bind-key -r u	join-pane -t :+		# unbreak, -r allows cycling windows
bind-key -r U	join-pane -t :-		# unbreak backwards
bind-key -r v	join-pane -ht :+	# unbreak (vertical split)
bind-key -r V	join-pane -ht :-	# unbreak (vertical split) backwards
bind-key    m	choose-window "join-pane -t '%%'"	# def: none
bind-key    A	set-window-option automatic-rename	# def: none	# toggle
bind-key -r H	resize-pane -L		# def: C-Left
bind-key -r J	resize-pane -D		# def: C-Down
bind-key -r K	resize-pane -U		# def: C-Up
bind-key -r L	resize-pane -R		# def: C-Right
bind-key -r o	rotate-window -D	# def: C-o
bind-key -r O	rotate-window -U	# def: none
bind-key -r {	swap-pane -D		# def: }
bind-key -r }	swap-pane -U		# def: {
bind-key    0	swap-pane -s :.0	# def: none	# swap to main pane

### Mouse Interaction  {{{2
set-option -qg	mouse-select-window on	# def: off
set-option -qg	mouse-resize-pane   on	# def: off
set-option -qg	mouse-select-pane   on	# def: off
set-window-option -qg	mode-mouse  on	# def: off
# new style
set-option -qg	mouse		    on	# def: off
set-option -qg	mouse-utf8	    on	# def: off

### Miscellaneous 
bind-key    a	set-option synchronize-panes	# moniker: type in [a]ll panes

## Destruction	{{{1

set-option -qg	detach-on-destroy  off	# def: on	# on/off=>detach/switch

### sessions	{{{2
#FIXME: confirm-before cannot take options.
#bind-key    Q	confirm-before -p "kill-session #{session_name} and exit? (y/n)" run-shell "tmux set-option -s -t '#{session_name}' detach-on-destroy on\\; kill-session -t '#{session_name}'"
#bind-key    C-x	choose-session "confirm-before -p 'kill-session? (y/n)' kill-session -t '#{session_name}'"
bind-key    X	confirm-before -p "kill-session '#{session_name}'? (y/n)" kill-session

### windows	{{{2
bind-key    x	confirm-before -p "kill-window '#{window_index}:#{window_name}'? (y/n)" kill-window

### panes	{{{2
bind-key    DC	confirm-before -p "kill-pane '#{pane_index}:#{pane_title}'? (y/n)" kill-pane


## Viewing	{{{1

set-window-option -qg	aggressive-resize   on	# Always maximise window

### copy mode	{{{2
bind-key    Escape  copy-mode		# def: [
bind-key    y	    copy-mode		# def: [
# put buffer into X selection:
bind-key    Y	    run-shell 'tmux save-buffer - | xclip -i -se p >/dev/null'
bind-key    C-y	    run-shell 'tmux save-buffer - | xclip -i -se c >/dev/null'
bind-key    p	    paste-buffer	# def: ]
# Past X selection:
bind-key    P	    run-shell 'xclip -o -se p | tmux load-buffer - \; paste-buffer'
bind-key    C-p	    run-shell 'xclip -o -se c | tmux load-buffer - \; paste-buffer'
bind-key    '#'	    choose-buffer	# def: =	# list-buffers is useless
bind-key -n C-Up    run-shell 'tmux copy-mode \; scroll-up'	# def: none	# FIXME
bind-key -n C-PgUp  copy-mode -u	# def: prefix PPage	# FIXME doesn't recieve key
#bind-key -n S-Up copy-mode | top-line	# Scroll up buffer like a vt
#bind-key -n S-PPage copy-mode -u	# Scroll up buffer like a vt
bind-key -t vi-copy	Escape	cancel		# def: C-c
bind-key -t vi-copy	v	begin-selection	# def: Space	# like 'visual'
bind-key -t vi-copy	y	copy-selection	# def: Enter	# like 'yank'
bind-key -t vi-copy	Y	copy-selection; run-shell 'tmux save-buffer - | xclip -i -se p >/dev/null'
bind-key -t vi-copy	C-Up	scroll-up	# def: C-Up	# FIXME doesn't recieve key
bind-key -t vi-copy	C-Down	scroll-down	# def: C-Down	# FIXME doesn't recieve key
bind-key -t vi-copy	C-PgUp	page-up		# def: PPage	# FIXME doesn't recieve key
bind-key -t vi-copy	C-PgDn	page-down	# def: NPage	# FIXME doesn't recieve key

### mouse binds	{{{2
# copied Drag from default for information:
bind-key -T root	MouseDrag1Pane	if-shell -t = -F "#{mouse_any_flag}" \
						"if-shell -t = -F '#{pane_in_mode}' \
							'copy-mode -M' \
							'send-keys -M'" \
						"copy-mode -M"
bind-key -T root	WheelUpPane	if-shell -t = -F "#{alternate_on}" \
						"send-key -M =" \
						"copy-mode -e; send-key -M ="
bind-key -t vi-copy	WheelUpPane	scroll-up #FIXME -n 5
bind-key -t vi-copy	WheelDownPane	scroll-down #FIXME ";" scroll-up";" scroll-up
bind-key -t vi-copy	MouseDown1Pane	begin-selection
#bind-key -t vi-copy	MouseDrag1Pane	begin-selection
unbind-key -t vi-copy	MouseDrag1Pane
bind-key -t vi-copy	MouseUp1Pane	copy-selection -x
bind-key -T root	MouseDown2Pane	if-shell -t = -F "#{alternate_on}" \
						"send-key -M =" \
						"select-pane -t =; paste-buffer"

### edit mode	{{{2
#bind-key -t	vi-edit	Escape	switch-mode	# def: Escape
bind-key -t	vi-edit	C-c	cancel		# def: C-c
bind-key -t	vi-edit	Tab	complete	# def: Tab
bind-key -t	vi-edit	C-u	delete-line	# def: C-u
bind-key -t	vi-edit	Up	history-up	# def: none
bind-key -t	vi-edit	Down	history-down	# def: none
bind-key -t	vi-edit	Left	cursor-left	# def: none
bind-key -t	vi-edit	Right	cursor-right	# def: none
#bind-key -ct	vi-edit	i	switch-mode	# def: i
bind-key -ct	vi-edit	Escape	cancel		# def: C-c
#bind-key -ct	vi-edit	A	end-of-line | switch-mode
#bind-key -ct	vi-edit	C	delete-end-of-line | switch-mode
#bind-key -ct	vi-edit	S	delete-line | switch-mode
bind-key -ct	vi-edit	p	paste


## Appearance	{{{1

### Monitor  {{{2
set-window-option -qg	monitor-activity    off		    # something happened
set-window-option -qg	monitor-content	    "* [/~]* [$#] " # [bash] prompt appeared
set-window-option -qg	monitor-silence	    0		    # nothing for N seconds
# Flash status line when monitored event occurs
set-option -qg	visual-activity		    on	# def: off
set-option -qg	visual-content		    on	# def: off
set-option -qg	visual-silence		    on	# def: off
set-option -qg	display-time		    700

### Status line	{{{2
set-option -qg	status-position		top		# bottom
set-option -qg	status-interval		5		# def: 15	# redraw time
set-option -qg	status-justify		centre		# def: left	# windows location
# status-{left,right} def:		'[#{session_name}]'	'"#{=24:pane_title}" %T %d-%b-%y'
set-option -qg	status-left		'[%R %d-%b-%y #(cpu_mem_usage -b -h1) ]'
set-option -qg	status-right		'[#{session_name}:#{window_index}.#{pane_index}#{?pane_synchronized,(S),}]'
# status-{left,right}-length def:	10		40
set-option -qg	status-left-length	23		# def: 10
set-option -qg	status-right-length	40		# def: 40

### Terminal Titles {{{2
set-option -qg	set-titles		on			# def: off
set-option -qg	set-titles-string	"#{pane_title}"

### Prettify	{{{2
#### Message	{{{3
set-option -qg	message-style		bold			# def: none
set-option -qag	message-style		'bg=#004400'#'#440044'	# def: yellow
set-option -qag	message-style		fg=brightwhite		# def: black
set-option -qg	message-command-style	none			# def: none
set-option -qag	message-command-style	'bg=#004400'#'#440044'	# def: black
set-option -qag	message-command-style	fg=white		# def: yellow
#### Status	{{{3
set-option -qg	status-style		none			# def: none
set-option -qag	status-style		'bg=#111111'		# def: green
set-option -qag	status-style		fg=white		# def: black
# status-\(left\|right\)-\(.*\) def: status-\2
set-option -qg	status-left-style	none
set-option -qag	status-left-style	'bg=#004400'#'#990099'
set-option -qag	status-left-style	fg=black
set-option -qg	status-right-style	none
set-option -qag	status-right-style	'bg=#004400'#'#990099'
set-option -qag	status-right-style	fg=black
#### Window (Status)	{{{3
# window-status-\(.*\) def: status-\1
#set-window-option -qg	window-status-style
#set-window-option -qag	window-status-style	bg= 
#set-window-option -qag	window-status-style	fg=
# window-status-\(current\|content\|activity\)-\(.*\) def: window-status-\2
set-window-option -qg	window-status-current-style	bold
set-window-option -qag	window-status-current-style	'bg=#007700'#'#AA00AA'
set-window-option -qag	window-status-current-style	fg=white
set-window-option -qg	window-status-content-style	none	# def: reverse
#set-window-option -qag	window-status-content-style
set-window-option -qag	window-status-content-style	fg=green
set-window-option -qg	window-status-activity-style	none	# def: reverse
#set-window-option -qag	window-status-activity-style	'bg=#333333'
set-window-option -qag	window-status-activity-style	fg=green#brightmagenta

## Misc		{{{1

### Insert Text	{{{2
#bind-key    I    command-prompt -p "Insert:" -I "tail -Fn200 " "send-keys '%%' Enter"
bind-key    I    command-prompt -p "Insert:" "if-shell 'case \"\$_TMUX_I_%1 \" in \" \"*) false;; esac' 'send-keys \$_TMUX_I_%1' 'send-keys \"%1\"'"
set-environment -g  _TMUX_I_ ""
set-environment -g  _TMUX_I_t "tail -Fn200 "
set-environment -g  _TMUX_I_l "tail -Fn200 /var/log/"
set-environment -g  _TMUX_I_e "engineering"
set-environment -g  _TMUX_I_E "engineering\n"
set-environment -g  _TMUX_I_se "ssh engineering@"
set-environment -g  _TMUX_I_sss "mysql -e 'SHOW SLAVE STATUS \\G'\n"

## End		}}}1
# vim: sts=4 fdm=marker noet
